(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const T="./",ne=`${T}assets/data/data.json`,P=`${T}assets/img/`,b=`${P}vangogh.png`,I=`${T}sounds/`,D=60,re=5e3,x=3,C=3,N=x*C,M=window.matchMedia("(prefers-reduced-motion: reduce)").matches,s={data:[],languages:[],currentItem:null,lastItemId:null,timeLeft:D,timerId:null,gameActive:!1,muted:!1,touchDrag:null},p={spinner:new Audio(`${I}spinner.mp3`),win:new Audio(`${I}win.mp3`),error:new Audio(`${I}error.mp3`)};p.spinner.loop=!0;p.spinner.volume=.4;p.win.volume=.7;p.error.volume=.7;const r={};document.addEventListener("DOMContentLoaded",()=>{oe(),ae(),se(),ie()});function oe(){r.gameImage=document.getElementById("gameImage"),r.pixelCanvas=document.getElementById("pixelCanvas"),r.imageCaption=document.getElementById("imageCaption"),r.progressWrap=document.getElementById("progressWrap"),r.progressFill=document.getElementById("progressFill"),r.progressText=document.getElementById("progressText"),r.progressBar=r.progressWrap.querySelector(".progress-bar"),r.startBtn=document.getElementById("startBtn"),r.status=document.getElementById("status"),r.board=document.getElementById("board"),r.muteToggle=document.getElementById("muteToggle"),r.endModal=document.getElementById("endModal"),r.newGameBtn=document.getElementById("newGameBtn")}function ae(){r.startBtn.addEventListener("click",k),r.muteToggle.addEventListener("click",Te),r.newGameBtn.addEventListener("click",De)}function se(){r.gameImage.src=b,r.startBtn.disabled=!0,r.progressWrap.hidden=!0,r.status.textContent="Loading game data...",O("Remembering Van Gogh"),te(!1),R()}async function ie(){try{const e=await fetch(ne,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to load data: ${e.status}`);const t=await e.json(),n=le(t);s.data=n.items,s.languages=n.languages,await de(),r.status.textContent="Press Start when you are ready.",r.startBtn.disabled=!1}catch(e){r.status.textContent="Unable to load game data. Please check assets/data/data.json.",console.error(e)}}function le(e){if(!e||!Array.isArray(e.items)||!e.items.length)throw new Error("Invalid data payload: items missing");const t=Array.isArray(e.languages)&&e.languages.length?e.languages:Object.keys(e.items[0].labels||{});if(!t.length)throw new Error("Invalid data payload: languages missing");if(t.length>N)throw new Error(`Invalid data payload: languages exceed ${N} word-pool slots`);const n=e.items.filter(o=>!o||typeof o.id!="string"||typeof o.image!="string"||!o.labels||typeof o.labels!="object"?!1:t.every(a=>typeof o.labels[a]=="string"&&o.labels[a].trim()));if(!n.length)throw new Error("No valid items found in data payload");return{languages:t,items:n}}async function de(){const e=s.data.map(n=>G(`${P}${n.image}`));e.push(G(b)),[p.spinner,p.win,p.error].forEach(n=>{n.load()}),await Promise.allSettled(e)}function G(e){return new Promise(t=>{const n=new Image;n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e})}async function k(){if(!(s.gameActive||!s.data.length)){B(),s.gameActive=!0,r.startBtn.disabled=!0,r.progressWrap.hidden=!0,r.board.innerHTML="",r.status.textContent="Preparing...";try{await U(r.gameImage),M?r.status.textContent="Selecting an image...":(S(p.spinner),await Me(),H(p.spinner));const e=ce();s.currentItem=e,r.gameImage.src=`${P}${e.image}`,await U(r.gameImage),O("Match the words to their languages."),ue(e),r.progressWrap.hidden=!1,Ie(),r.status.textContent="Drag each word to the matching language."}catch(e){s.gameActive=!1,r.startBtn.disabled=!1,H(p.spinner),r.status.textContent="Something went wrong while starting the game.",console.error(e)}}}function ce(){if(!s.data.length)return null;const e=s.data.filter(a=>a.id!==s.lastItemId),t=e.length?e:s.data,n=Math.floor(Math.random()*t.length),o=t[n];return s.lastItemId=o.id,o}function ue(e){r.board.innerHTML="",r.board.classList.remove("is-locked");const t=document.createElement("div");t.className="board-column";const n=document.createElement("div");n.className="board-column";const o=document.createElement("h3");o.textContent="Languages";const a=document.createElement("h3");a.textContent="Words";const i=document.createElement("div");i.className="panel-list";const l=document.createElement("div");l.className="panel-list word-pool",l.id="wordPool",l.style.setProperty("--word-pool-rows",String(x)),l.style.setProperty("--word-pool-cols",String(C));const u=E([...s.languages]),d=E(u.map(m=>e.labels[m]));u.forEach(m=>{const c=document.createElement("div");c.className="language-panel",c.dataset.language=m,c.dataset.expected=e.labels[m],c.tabIndex=0;const g=document.createElement("span");g.className="label",g.textContent=m;const f=document.createElement("span");f.className="placeholder",f.textContent="Drop word here",c.appendChild(g),c.appendChild(f),c.addEventListener("dragover",q),c.addEventListener("dragenter",_),c.addEventListener("dragleave",F),c.addEventListener("drop",pe),i.appendChild(c)}),d.forEach((m,c)=>{const g=document.createElement("div");g.className="word-tile",g.textContent=m,g.id=`word-${c}`,g.draggable=!0,g.tabIndex=0,g.dataset.word=m,g.addEventListener("dragstart",ge),g.addEventListener("dragend",me),g.addEventListener("pointerdown",he),l.appendChild(g)}),l.addEventListener("dragover",q),l.addEventListener("dragenter",_),l.addEventListener("dragleave",F),l.addEventListener("drop",fe),t.appendChild(o),t.appendChild(i),n.appendChild(a),n.appendChild(l),r.board.appendChild(t),r.board.appendChild(n),Se(l,x,C),Ce(l)}function ge(e){const t=e.currentTarget;t.classList.add("dragging"),e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move"}function me(e){e.currentTarget.classList.remove("dragging")}function q(e){e.preventDefault()}function _(e){e.preventDefault(),e.currentTarget.classList.add("drop-hover")}function F(e){e.currentTarget.classList.remove("drop-hover")}function pe(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=j(e);t&&X(e.currentTarget,t)}function fe(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=j(e);t&&A(t)}function X(e,t){var a;const n=t.parentElement,o=e.querySelector(".word-tile");o&&o!==t&&A(o),n&&n.classList.contains("language-panel")&&ee(n),(a=e.querySelector(".placeholder"))==null||a.remove(),e.appendChild(t),t.classList.add("is-snapped"),$(t),Le()}function j(e){const t=e.dataTransfer.getData("text/plain");return t?document.getElementById(t):null}function A(e){const t=document.getElementById("wordPool");if(!t)return;const n=e.parentElement;e.classList.remove("is-snapped"),t.appendChild(e),$(e),n&&n.classList.contains("language-panel")&&ee(n)}function he(e){if(e.pointerType==="mouse"||!s.gameActive||s.touchDrag)return;const t=e.currentTarget,n=t.getBoundingClientRect(),o=t.parentElement;let a=null;o&&o.classList.contains("word-pool")&&(a=document.createElement("div"),a.className="tile-placeholder",a.style.width=`${n.width}px`,a.style.height=`${n.height}px`,a.style.gridRowStart=t.style.gridRowStart,a.style.gridColumnStart=t.style.gridColumnStart,o.insertBefore(a,t)),s.touchDrag={tile:t,pointerId:e.pointerId,offsetX:e.clientX-n.left,offsetY:e.clientY-n.top,originParent:o,placeholder:a,hoverTarget:null,originalStyles:{position:t.style.position,left:t.style.left,top:t.style.top,width:t.style.width,height:t.style.height,zIndex:t.style.zIndex,pointerEvents:t.style.pointerEvents,margin:t.style.margin}},t.classList.add("dragging"),t.style.position="fixed",t.style.left=`${n.left}px`,t.style.top=`${n.top}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.style.zIndex="1000",t.style.pointerEvents="none",t.style.margin="0";try{t.setPointerCapture(e.pointerId)}catch{}e.preventDefault(),window.addEventListener("pointermove",Y),window.addEventListener("pointerup",V),window.addEventListener("pointercancel",K)}function Y(e){const t=s.touchDrag;if(!t||t.pointerId!==e.pointerId)return;e.preventDefault();const n=e.clientX-t.offsetX,o=e.clientY-t.offsetY;t.tile.style.left=`${n}px`,t.tile.style.top=`${o}px`,ye(Q(e.clientX,e.clientY))}function V(e){J(e,!1)}function K(e){J(e,!0)}function J(e,t){const n=s.touchDrag;if(!n||n.pointerId!==e.pointerId)return;const o=t?null:Q(e.clientX,e.clientY);we(),o&&o.classList.contains("language-panel")?X(o,n.tile):o&&o.id==="wordPool"?A(n.tile):ve(n),Ee()}function Q(e,t){const n=document.elementFromPoint(e,t);if(!n)return null;const o=n.closest(".language-panel");return o||n.closest("#wordPool")}function ye(e){const t=s.touchDrag;!t||t.hoverTarget===e||(t.hoverTarget&&t.hoverTarget.classList.remove("drop-hover"),t.hoverTarget=e,e&&e.classList.add("drop-hover"))}function we(){const e=s.touchDrag;e&&e.hoverTarget&&(e.hoverTarget.classList.remove("drop-hover"),e.hoverTarget=null)}function ve(e){var t;!e||!e.originParent||(e.originParent.classList.contains("language-panel")?((t=e.originParent.querySelector(".placeholder"))==null||t.remove(),e.originParent.appendChild(e.tile),e.tile.classList.add("is-snapped")):(e.originParent.appendChild(e.tile),e.tile.classList.remove("is-snapped")),$(e.tile))}function Ee(){const e=s.touchDrag;e&&(e.placeholder&&e.placeholder.remove(),window.removeEventListener("pointermove",Y),window.removeEventListener("pointerup",V),window.removeEventListener("pointercancel",K),s.touchDrag=null)}function $(e){if(!e)return;e.classList.remove("dragging");const t=s.touchDrag&&s.touchDrag.tile===e?s.touchDrag:null;t&&t.originalStyles?(e.style.position=t.originalStyles.position,e.style.left=t.originalStyles.left,e.style.top=t.originalStyles.top,e.style.width=t.originalStyles.width,e.style.height=t.originalStyles.height,e.style.zIndex=t.originalStyles.zIndex,e.style.pointerEvents=t.originalStyles.pointerEvents,e.style.margin=t.originalStyles.margin):(e.style.position="",e.style.left="",e.style.top="",e.style.zIndex="",e.style.pointerEvents="",e.style.margin="")}function Le(){const e=r.board.querySelectorAll(".language-panel");if(!e.length)return;Array.from(e).every(n=>n.querySelector(".word-tile"))&&Z("completed")}function Ie(){s.timeLeft=D,z(),s.timerId=window.setInterval(()=>{s.timeLeft-=1,z(),s.timeLeft<=0&&Z("timeout")},1e3)}function z(){const e=String(Math.floor(s.timeLeft/60)).padStart(2,"0"),t=String(s.timeLeft%60).padStart(2,"0");r.progressText.textContent=`${e}:${t}`;const n=Math.max(0,s.timeLeft/D);r.progressFill.style.width=`${n*100}%`,r.progressBar.setAttribute("aria-valuenow",String(s.timeLeft))}function Z(e){if(!s.gameActive)return;s.gameActive=!1,B(),r.board.classList.add("is-locked");const t=r.board.querySelectorAll(".language-panel");let n=!0;t.forEach(o=>{const a=o.dataset.expected,i=o.querySelector(".word-tile"),l=i?i.dataset.word:null,u=l&&l===a;o.classList.remove("is-correct","is-wrong"),o.classList.add(u?"is-correct":"is-wrong"),u||(n=!1)}),e==="timeout"?r.status.textContent="Time is up. Review your matches.":r.status.textContent="All pairs placed. Reviewing your matches.",n?(S(p.win),Pe()):S(p.error),be()}function xe(){B(),r.board.innerHTML="",r.board.classList.remove("is-locked"),r.progressWrap.hidden=!0,r.startBtn.disabled=!1,r.gameImage.src=b,s.currentItem=null,O("Remembering Van Gogh"),r.status.textContent="Press Start when you are ready.",R()}function ee(e){if(e.querySelector(".word-tile")||e.querySelector(".placeholder"))return;const t=document.createElement("span");t.className="placeholder",t.textContent="Drop word here",e.appendChild(t)}function Ce(e){const t=Array.from(e.querySelectorAll(".word-tile"));if(!t.length)return;const n=()=>{const o=t.reduce((a,i)=>{i.style.width="auto";const l=i.scrollWidth;return Math.max(a,l)},0);o&&t.forEach(a=>{a.style.width=`${Math.ceil(o)}px`})};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>requestAnimationFrame(n)):requestAnimationFrame(n)}function Se(e,t,n){const o=Array.from(e.querySelectorAll(".word-tile")),a=t*n;if(o.length>a)return;const i=[];for(let l=1;l<=t;l+=1)for(let u=1;u<=n;u+=1)i.push({row:l,col:u});E(i),o.forEach((l,u)=>{const d=i[u];d&&(l.style.gridRowStart=d.row,l.style.gridColumnStart=d.col)})}function B(){s.timerId&&(window.clearInterval(s.timerId),s.timerId=null)}function Te(){te(!s.muted)}function te(e){s.muted=e;const t=e?"Sound: Off":"Sound: On";r.muteToggle.textContent=t,r.muteToggle.setAttribute("aria-pressed",String(e)),Object.values(p).forEach(n=>{n.muted=e})}function S(e){s.muted||(e.currentTime=0,e.play().catch(()=>{}))}function H(e){e.pause(),e.currentTime=0}function O(e){r.imageCaption.textContent=e}function Pe(){if(M)return;const e=10,t=26,n=["#df7a4f","#1f6f5a","#ffe800","#667eea","#f093fb"],o=document.createElement("div");o.className="confetti",o.setAttribute("aria-hidden","true");for(let a=0;a<e;a+=1){const i=15+Math.random()*70,l=8+Math.random()*28;for(let u=0;u<t;u+=1){const d=document.createElement("span"),m=Math.floor(5+Math.random()*6),c=Math.random()*Math.PI*2,g=110+Math.random()*150,f=Math.cos(c)*g,h=Math.sin(c)*g,y=Math.random()*.25,L=2.3+Math.random()*1.2,w=n[(a+u)%n.length],v=Math.random()>.45?"999px":"2px";d.style.width=`${m}px`,d.style.height=`${Math.ceil(m*1.3)}px`,d.style.backgroundColor=w,d.style.setProperty("--origin-x",`${i}vw`),d.style.setProperty("--origin-y",`${l}vh`),d.style.setProperty("--dx",`${f.toFixed(1)}px`),d.style.setProperty("--dy",`${h.toFixed(1)}px`),d.style.setProperty("--rot",`${Math.floor(Math.random()*360)}deg`),d.style.setProperty("--delay",`${y.toFixed(2)}s`),d.style.setProperty("--duration",`${L.toFixed(2)}s`),d.style.setProperty("--round",v),o.appendChild(d)}}document.body.appendChild(o),window.setTimeout(()=>{o.remove()},3500)}function be(){var e;r.endModal&&(r.endModal.hidden=!1,(e=r.newGameBtn)==null||e.focus())}function R(){r.endModal&&(r.endModal.hidden=!0)}function De(){R(),xe(),k()}async function U(e){e.complete&&e.naturalWidth>0||await new Promise((t,n)=>{const o=()=>{i(),t()},a=()=>{i(),n(new Error("Image failed to load"))},i=()=>{e.removeEventListener("load",o),e.removeEventListener("error",a)};e.addEventListener("load",o),e.addEventListener("error",a)})}function Me(){return M?Promise.resolve():new Promise(e=>{const t=r.gameImage,n=r.pixelCanvas,o=n.getContext("2d"),a=t.naturalWidth||t.clientWidth,i=t.naturalHeight||t.clientHeight;n.width=a,n.height=i,n.style.width=`${t.clientWidth}px`,n.style.height=`${t.clientHeight}px`,n.style.display="block",t.style.opacity="0";const l=24,u=24,d=a/u,m=i/l,c=[];for(let h=0;h<l;h+=1)for(let y=0;y<u;y+=1)c.push({row:h,col:y});const g=performance.now(),f=h=>{const y=h-g;E(c);let L=0;for(let w=0;w<l;w+=1)for(let v=0;v<u;v+=1){const W=c[L++];o.drawImage(t,v*d,w*m,d,m,W.col*d,W.row*m,d,m)}y<re?requestAnimationFrame(f):(n.style.display="none",t.style.opacity="1",e())};requestAnimationFrame(f)})}function E(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}
