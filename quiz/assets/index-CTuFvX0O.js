(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const T="./",oe=`${T}assets/data/data.json`,S=`${T}assets/img/`,P=`${S}vangogh.png`,I=`${T}sounds/`,D=60,re=5e3,x=3,C=3,W=x*C,A=window.matchMedia("(prefers-reduced-motion: reduce)").matches,s={data:[],languages:[],currentItem:null,lastItemId:null,timeLeft:D,timerId:null,gameActive:!1,muted:!1,touchDrag:null,audioUnlocked:!1},p={spinner:new Audio(`${I}spinner.mp3`),win:new Audio(`${I}win.mp3`),error:new Audio(`${I}error.mp3`)};p.spinner.loop=!0;p.spinner.volume=.4;p.win.volume=.7;p.error.volume=.7;const o={};document.addEventListener("DOMContentLoaded",()=>{ae(),se(),ie(),le()});function ae(){o.gameImage=document.getElementById("gameImage"),o.pixelCanvas=document.getElementById("pixelCanvas"),o.imageCaption=document.getElementById("imageCaption"),o.progressWrap=document.getElementById("progressWrap"),o.progressFill=document.getElementById("progressFill"),o.progressText=document.getElementById("progressText"),o.progressBar=o.progressWrap.querySelector(".progress-bar"),o.startBtn=document.getElementById("startBtn"),o.status=document.getElementById("status"),o.board=document.getElementById("board"),o.muteToggle=document.getElementById("muteToggle"),o.endModal=document.getElementById("endModal"),o.newGameBtn=document.getElementById("newGameBtn")}function se(){o.startBtn.addEventListener("click",z),o.muteToggle.addEventListener("click",Se),o.newGameBtn.addEventListener("click",Me),Pe()}function ie(){o.gameImage.src=P,o.startBtn.disabled=!0,o.progressWrap.hidden=!0,o.status.textContent="Loading game data...",O("Remembering Van Gogh"),te(!1),R()}async function le(){try{const e=await fetch(oe,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to load data: ${e.status}`);const t=await e.json(),n=de(t);s.data=n.items,s.languages=n.languages,await ce(),o.status.textContent="Press Start when you are ready.",o.startBtn.disabled=!1}catch(e){o.status.textContent="Unable to load game data. Please check assets/data/data.json.",console.error(e)}}function de(e){if(!e||!Array.isArray(e.items)||!e.items.length)throw new Error("Invalid data payload: items missing");const t=Array.isArray(e.languages)&&e.languages.length?e.languages:Object.keys(e.items[0].labels||{});if(!t.length)throw new Error("Invalid data payload: languages missing");if(t.length>W)throw new Error(`Invalid data payload: languages exceed ${W} word-pool slots`);const n=e.items.filter(r=>!r||typeof r.id!="string"||typeof r.image!="string"||!r.labels||typeof r.labels!="object"?!1:t.every(a=>typeof r.labels[a]=="string"&&r.labels[a].trim()));if(!n.length)throw new Error("No valid items found in data payload");return{languages:t,items:n}}async function ce(){const e=s.data.map(n=>k(`${S}${n.image}`));e.push(k(P)),[p.spinner,p.win,p.error].forEach(n=>{n.load()}),await Promise.allSettled(e)}function k(e){return new Promise(t=>{const n=new Image;n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e})}async function z(){if(!(s.gameActive||!s.data.length)){await ne(),B(),s.gameActive=!0,o.startBtn.disabled=!0,o.progressWrap.hidden=!0,o.board.innerHTML="",o.status.textContent="Preparing...";try{await j(o.gameImage),A?o.status.textContent="Selecting an image...":(b(p.spinner),await $e(),U(p.spinner));const e=ue();s.currentItem=e,o.gameImage.src=`${S}${e.image}`,await j(o.gameImage),O("Match the words to their languages."),ge(e),o.progressWrap.hidden=!1,xe(),o.status.textContent="Drag each word to the matching language."}catch(e){s.gameActive=!1,o.startBtn.disabled=!1,U(p.spinner),o.status.textContent="Something went wrong while starting the game.",console.error(e)}}}function ue(){if(!s.data.length)return null;const e=s.data.filter(a=>a.id!==s.lastItemId),t=e.length?e:s.data,n=Math.floor(Math.random()*t.length),r=t[n];return s.lastItemId=r.id,r}function ge(e){o.board.innerHTML="",o.board.classList.remove("is-locked");const t=document.createElement("div");t.className="board-column";const n=document.createElement("div");n.className="board-column";const r=document.createElement("h3");r.textContent="Languages";const a=document.createElement("h3");a.textContent="Words";const i=document.createElement("div");i.className="panel-list";const l=document.createElement("div");l.className="panel-list word-pool",l.id="wordPool",l.style.setProperty("--word-pool-rows",String(x)),l.style.setProperty("--word-pool-cols",String(C));const u=E([...s.languages]),d=E(u.map(m=>e.labels[m]));u.forEach(m=>{const c=document.createElement("div");c.className="language-panel",c.dataset.language=m,c.dataset.expected=e.labels[m],c.tabIndex=0;const g=document.createElement("span");g.className="label",g.textContent=m;const f=document.createElement("span");f.className="placeholder",f.textContent="Drop word here",c.appendChild(g),c.appendChild(f),c.addEventListener("dragover",G),c.addEventListener("dragenter",q),c.addEventListener("dragleave",_),c.addEventListener("drop",fe),i.appendChild(c)}),d.forEach((m,c)=>{const g=document.createElement("div");g.className="word-tile",g.textContent=m,g.id=`word-${c}`,g.draggable=!0,g.tabIndex=0,g.dataset.word=m,g.addEventListener("dragstart",me),g.addEventListener("dragend",pe),g.addEventListener("pointerdown",ye),l.appendChild(g)}),l.addEventListener("dragover",G),l.addEventListener("dragenter",q),l.addEventListener("dragleave",_),l.addEventListener("drop",he),t.appendChild(r),t.appendChild(i),n.appendChild(a),n.appendChild(l),o.board.appendChild(t),o.board.appendChild(n),Te(l,x,C),be(l)}function me(e){const t=e.currentTarget;t.classList.add("dragging"),e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move"}function pe(e){e.currentTarget.classList.remove("dragging")}function G(e){e.preventDefault()}function q(e){e.preventDefault(),e.currentTarget.classList.add("drop-hover")}function _(e){e.currentTarget.classList.remove("drop-hover")}function fe(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=X(e);t&&H(e.currentTarget,t)}function he(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=X(e);t&&M(t)}function H(e,t){var a;const n=t.parentElement,r=e.querySelector(".word-tile");r&&r!==t&&M(r),n&&n.classList.contains("language-panel")&&ee(n),(a=e.querySelector(".placeholder"))==null||a.remove(),e.appendChild(t),t.classList.add("is-snapped"),$(t),Ie()}function X(e){const t=e.dataTransfer.getData("text/plain");return t?document.getElementById(t):null}function M(e){const t=document.getElementById("wordPool");if(!t)return;const n=e.parentElement;e.classList.remove("is-snapped"),t.appendChild(e),$(e),n&&n.classList.contains("language-panel")&&ee(n)}function ye(e){if(e.pointerType==="mouse"||!s.gameActive||s.touchDrag)return;const t=e.currentTarget,n=t.getBoundingClientRect(),r=t.parentElement;let a=null;r&&r.classList.contains("word-pool")&&(a=document.createElement("div"),a.className="tile-placeholder",a.style.width=`${n.width}px`,a.style.height=`${n.height}px`,a.style.gridRowStart=t.style.gridRowStart,a.style.gridColumnStart=t.style.gridColumnStart,r.insertBefore(a,t)),s.touchDrag={tile:t,pointerId:e.pointerId,offsetX:e.clientX-n.left,offsetY:e.clientY-n.top,originParent:r,placeholder:a,hoverTarget:null,originalStyles:{position:t.style.position,left:t.style.left,top:t.style.top,width:t.style.width,height:t.style.height,zIndex:t.style.zIndex,pointerEvents:t.style.pointerEvents,margin:t.style.margin}},t.classList.add("dragging"),t.style.position="fixed",t.style.left=`${n.left}px`,t.style.top=`${n.top}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.style.zIndex="1000",t.style.pointerEvents="none",t.style.margin="0";try{t.setPointerCapture(e.pointerId)}catch{}e.preventDefault(),window.addEventListener("pointermove",Y),window.addEventListener("pointerup",V),window.addEventListener("pointercancel",K)}function Y(e){const t=s.touchDrag;if(!t||t.pointerId!==e.pointerId)return;e.preventDefault();const n=e.clientX-t.offsetX,r=e.clientY-t.offsetY;t.tile.style.left=`${n}px`,t.tile.style.top=`${r}px`,we(Q(e.clientX,e.clientY))}function V(e){J(e,!1)}function K(e){J(e,!0)}function J(e,t){const n=s.touchDrag;if(!n||n.pointerId!==e.pointerId)return;const r=t?null:Q(e.clientX,e.clientY);ve(),r&&r.classList.contains("language-panel")?H(r,n.tile):r&&r.id==="wordPool"?M(n.tile):Ee(n),Le()}function Q(e,t){const n=document.elementFromPoint(e,t);if(!n)return null;const r=n.closest(".language-panel");return r||n.closest("#wordPool")}function we(e){const t=s.touchDrag;!t||t.hoverTarget===e||(t.hoverTarget&&t.hoverTarget.classList.remove("drop-hover"),t.hoverTarget=e,e&&e.classList.add("drop-hover"))}function ve(){const e=s.touchDrag;e&&e.hoverTarget&&(e.hoverTarget.classList.remove("drop-hover"),e.hoverTarget=null)}function Ee(e){var t;!e||!e.originParent||(e.originParent.classList.contains("language-panel")?((t=e.originParent.querySelector(".placeholder"))==null||t.remove(),e.originParent.appendChild(e.tile),e.tile.classList.add("is-snapped")):(e.originParent.appendChild(e.tile),e.tile.classList.remove("is-snapped")),$(e.tile))}function Le(){const e=s.touchDrag;e&&(e.placeholder&&e.placeholder.remove(),window.removeEventListener("pointermove",Y),window.removeEventListener("pointerup",V),window.removeEventListener("pointercancel",K),s.touchDrag=null)}function $(e){if(!e)return;e.classList.remove("dragging");const t=s.touchDrag&&s.touchDrag.tile===e?s.touchDrag:null;t&&t.originalStyles?(e.style.position=t.originalStyles.position,e.style.left=t.originalStyles.left,e.style.top=t.originalStyles.top,e.style.width=t.originalStyles.width,e.style.height=t.originalStyles.height,e.style.zIndex=t.originalStyles.zIndex,e.style.pointerEvents=t.originalStyles.pointerEvents,e.style.margin=t.originalStyles.margin):(e.style.position="",e.style.left="",e.style.top="",e.style.zIndex="",e.style.pointerEvents="",e.style.margin="")}function Ie(){const e=o.board.querySelectorAll(".language-panel");if(!e.length)return;Array.from(e).every(n=>n.querySelector(".word-tile"))&&Z("completed")}function xe(){s.timeLeft=D,F(),s.timerId=window.setInterval(()=>{s.timeLeft-=1,F(),s.timeLeft<=0&&Z("timeout")},1e3)}function F(){const e=String(Math.floor(s.timeLeft/60)).padStart(2,"0"),t=String(s.timeLeft%60).padStart(2,"0");o.progressText.textContent=`${e}:${t}`;const n=Math.max(0,s.timeLeft/D);o.progressFill.style.width=`${n*100}%`,o.progressBar.setAttribute("aria-valuenow",String(s.timeLeft))}function Z(e){if(!s.gameActive)return;s.gameActive=!1,B(),o.board.classList.add("is-locked");const t=o.board.querySelectorAll(".language-panel");let n=!0;t.forEach(r=>{const a=r.dataset.expected,i=r.querySelector(".word-tile"),l=i?i.dataset.word:null,u=l&&l===a;r.classList.remove("is-correct","is-wrong"),r.classList.add(u?"is-correct":"is-wrong"),u||(n=!1)}),e==="timeout"?o.status.textContent="Time is up. Review your matches.":o.status.textContent="All pairs placed. Reviewing your matches.",n?(b(p.win),De()):b(p.error),Ae()}function Ce(){B(),o.board.innerHTML="",o.board.classList.remove("is-locked"),o.progressWrap.hidden=!0,o.startBtn.disabled=!1,o.gameImage.src=P,s.currentItem=null,O("Remembering Van Gogh"),o.status.textContent="Press Start when you are ready.",R()}function ee(e){if(e.querySelector(".word-tile")||e.querySelector(".placeholder"))return;const t=document.createElement("span");t.className="placeholder",t.textContent="Drop word here",e.appendChild(t)}function be(e){const t=Array.from(e.querySelectorAll(".word-tile"));if(!t.length)return;const n=()=>{const r=t.reduce((a,i)=>{i.style.width="auto";const l=i.scrollWidth;return Math.max(a,l)},0);r&&t.forEach(a=>{a.style.width=`${Math.ceil(r)}px`})};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>requestAnimationFrame(n)):requestAnimationFrame(n)}function Te(e,t,n){const r=Array.from(e.querySelectorAll(".word-tile")),a=t*n;if(r.length>a)return;const i=[];for(let l=1;l<=t;l+=1)for(let u=1;u<=n;u+=1)i.push({row:l,col:u});E(i),r.forEach((l,u)=>{const d=i[u];d&&(l.style.gridRowStart=d.row,l.style.gridColumnStart=d.col)})}function B(){s.timerId&&(window.clearInterval(s.timerId),s.timerId=null)}function Se(){te(!s.muted)}function te(e){s.muted=e;const t=e?"Sound: Off":"Sound: On";o.muteToggle.textContent=t,o.muteToggle.setAttribute("aria-pressed",String(e)),Object.values(p).forEach(n=>{n.muted=e})}function b(e){s.muted||(e.currentTime=0,e.play().catch(t=>{(t==null?void 0:t.name)==="NotAllowedError"&&(s.audioUnlocked=!1),console.debug("Audio playback blocked or failed:",t)}))}function U(e){e.pause(),e.currentTime=0}function Pe(){const e=()=>{ne()};window.addEventListener("pointerdown",e,{once:!0,passive:!0}),window.addEventListener("touchstart",e,{once:!0,passive:!0}),window.addEventListener("keydown",e,{once:!0})}async function ne(){if(s.audioUnlocked)return;const e=s.muted,t=new Map;try{Object.values(p).forEach(n=>{t.set(n,n.currentTime),n.muted=!0}),await Promise.allSettled(Object.values(p).map(async n=>{const r=n.play();r&&typeof r.then=="function"&&await r,n.pause()})),s.audioUnlocked=!0}catch(n){console.debug("Audio unlock attempt failed:",n)}finally{Object.values(p).forEach(n=>{n.currentTime=t.get(n)||0,n.muted=e})}}function O(e){o.imageCaption.textContent=e}function De(){if(A)return;const e=10,t=26,n=["#df7a4f","#1f6f5a","#ffe800","#667eea","#f093fb"],r=document.createElement("div");r.className="confetti",r.setAttribute("aria-hidden","true");for(let a=0;a<e;a+=1){const i=15+Math.random()*70,l=8+Math.random()*28;for(let u=0;u<t;u+=1){const d=document.createElement("span"),m=Math.floor(5+Math.random()*6),c=Math.random()*Math.PI*2,g=110+Math.random()*150,f=Math.cos(c)*g,h=Math.sin(c)*g,y=Math.random()*.25,L=2.3+Math.random()*1.2,w=n[(a+u)%n.length],v=Math.random()>.45?"999px":"2px";d.style.width=`${m}px`,d.style.height=`${Math.ceil(m*1.3)}px`,d.style.backgroundColor=w,d.style.setProperty("--origin-x",`${i}vw`),d.style.setProperty("--origin-y",`${l}vh`),d.style.setProperty("--dx",`${f.toFixed(1)}px`),d.style.setProperty("--dy",`${h.toFixed(1)}px`),d.style.setProperty("--rot",`${Math.floor(Math.random()*360)}deg`),d.style.setProperty("--delay",`${y.toFixed(2)}s`),d.style.setProperty("--duration",`${L.toFixed(2)}s`),d.style.setProperty("--round",v),r.appendChild(d)}}document.body.appendChild(r),window.setTimeout(()=>{r.remove()},3500)}function Ae(){var e;o.endModal&&(o.endModal.hidden=!1,(e=o.newGameBtn)==null||e.focus())}function R(){o.endModal&&(o.endModal.hidden=!0)}function Me(){R(),Ce(),z()}async function j(e){e.complete&&e.naturalWidth>0||await new Promise((t,n)=>{const r=()=>{i(),t()},a=()=>{i(),n(new Error("Image failed to load"))},i=()=>{e.removeEventListener("load",r),e.removeEventListener("error",a)};e.addEventListener("load",r),e.addEventListener("error",a)})}function $e(){return A?Promise.resolve():new Promise(e=>{const t=o.gameImage,n=o.pixelCanvas,r=n.getContext("2d"),a=t.naturalWidth||t.clientWidth,i=t.naturalHeight||t.clientHeight;n.width=a,n.height=i,n.style.width=`${t.clientWidth}px`,n.style.height=`${t.clientHeight}px`,n.style.display="block",t.style.opacity="0";const l=24,u=24,d=a/u,m=i/l,c=[];for(let h=0;h<l;h+=1)for(let y=0;y<u;y+=1)c.push({row:h,col:y});const g=performance.now(),f=h=>{const y=h-g;E(c);let L=0;for(let w=0;w<l;w+=1)for(let v=0;v<u;v+=1){const N=c[L++];r.drawImage(t,v*d,w*m,d,m,N.col*d,N.row*m,d,m)}y<re?requestAnimationFrame(f):(n.style.display="none",t.style.opacity="1",e())};requestAnimationFrame(f)})}function E(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}
