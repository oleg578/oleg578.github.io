(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const C="./",V=`${C}assets/data/data.json`,b=`${C}assets/img/`,T=`${b}vangogh.png`,x=`${C}sounds/`,K=60,J=5e3,P=window.matchMedia("(prefers-reduced-motion: reduce)").matches,l={data:[],languages:[],currentItem:null,lastItemId:null,timeLeft:K,timerId:null,gameActive:!1,muted:!1,touchDrag:null},m={spinner:new Audio(`${x}spinner.mp3`),win:new Audio(`${x}win.mp3`),error:new Audio(`${x}error.mp3`)};m.spinner.loop=!0;m.spinner.volume=.4;m.win.volume=.7;m.error.volume=.7;const r={};document.addEventListener("DOMContentLoaded",()=>{Q(),Z(),ee(),te()});function Q(){r.gameImage=document.getElementById("gameImage"),r.pixelCanvas=document.getElementById("pixelCanvas"),r.imageCaption=document.getElementById("imageCaption"),r.progressWrap=document.getElementById("progressWrap"),r.progressFill=document.getElementById("progressFill"),r.progressText=document.getElementById("progressText"),r.progressBar=r.progressWrap.querySelector(".progress-bar"),r.startBtn=document.getElementById("startBtn"),r.status=document.getElementById("status"),r.board=document.getElementById("board"),r.muteToggle=document.getElementById("muteToggle"),r.endModal=document.getElementById("endModal"),r.newGameBtn=document.getElementById("newGameBtn")}function Z(){r.startBtn.addEventListener("click",G),r.muteToggle.addEventListener("click",Ee),r.newGameBtn.addEventListener("click",Ie)}function ee(){r.gameImage.src=T,r.startBtn.disabled=!0,r.progressWrap.hidden=!0,r.status.textContent="Loading game data...",A("Remembering Van Gogh"),Y(!1),M()}async function te(){try{const e=await fetch(V,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to load data: ${e.status}`);const t=await e.json(),n=ne(t);l.data=n.items,l.languages=n.languages,await re(),r.status.textContent="Press Start when you are ready.",r.startBtn.disabled=!1}catch(e){r.status.textContent="Unable to load game data. Please check assets/data/data.json.",console.error(e)}}function ne(e){if(!e||!Array.isArray(e.items)||!e.items.length)throw new Error("Invalid data payload: items missing");const t=Array.isArray(e.languages)&&e.languages.length?e.languages:Object.keys(e.items[0].labels||{});if(!t.length)throw new Error("Invalid data payload: languages missing");const n=e.items.filter(o=>!o||typeof o.id!="string"||typeof o.image!="string"||!o.labels||typeof o.labels!="object"?!1:t.every(a=>typeof o.labels[a]=="string"&&o.labels[a].trim()));if(!n.length)throw new Error("No valid items found in data payload");return{languages:t,items:n}}async function re(){const e=l.data.map(n=>$(`${b}${n.image}`));e.push($(T)),[m.spinner,m.win,m.error].forEach(n=>{n.load()}),await Promise.allSettled(e)}function $(e){return new Promise(t=>{const n=new Image;n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e})}async function G(){if(!(l.gameActive||!l.data.length)){l.gameActive=!0,r.startBtn.disabled=!0,r.progressWrap.hidden=!0,r.board.innerHTML="",r.status.textContent="Preparing...";try{await F(r.gameImage),P?r.status.textContent="Selecting an image...":(I(m.spinner),await Ce(),W(m.spinner));const e=oe();l.currentItem=e,r.gameImage.src=`${b}${e.image}`,await F(r.gameImage),A("Match the words to their languages."),ae(e),r.progressWrap.hidden=!1,r.status.textContent="Drag each word to the matching language."}catch(e){l.gameActive=!1,r.startBtn.disabled=!1,W(m.spinner),r.status.textContent="Something went wrong while starting the game.",console.error(e)}}}function oe(){if(!l.data.length)return null;const e=l.data.filter(a=>a.id!==l.lastItemId),t=e.length?e:l.data,n=Math.floor(Math.random()*t.length),o=t[n];return l.lastItemId=o.id,o}function ae(e){r.board.innerHTML="",r.board.classList.remove("is-locked");const t=document.createElement("div");t.className="board-column";const n=document.createElement("div");n.className="board-column";const o=document.createElement("h3");o.textContent="Languages";const a=document.createElement("h3");a.textContent="Words";const s=document.createElement("div");s.className="panel-list";const i=document.createElement("div");i.className="panel-list word-pool",i.id="wordPool";const u=E([...l.languages]),d=E(u.map(p=>e.labels[p]));u.forEach(p=>{const c=document.createElement("div");c.className="language-panel",c.dataset.language=p,c.dataset.expected=e.labels[p],c.tabIndex=0;const g=document.createElement("span");g.className="label",g.textContent=p;const f=document.createElement("span");f.className="placeholder",f.textContent="Drop word here",c.appendChild(g),c.appendChild(f),c.addEventListener("dragover",N),c.addEventListener("dragenter",O),c.addEventListener("dragleave",q),c.addEventListener("drop",le),s.appendChild(c)}),d.forEach((p,c)=>{const g=document.createElement("div");g.className="word-tile",g.textContent=p,g.id=`word-${c}`,g.draggable=!0,g.tabIndex=0,g.dataset.word=p,g.addEventListener("dragstart",se),g.addEventListener("dragend",ie),g.addEventListener("pointerdown",ce),i.appendChild(g)}),i.addEventListener("dragover",N),i.addEventListener("dragenter",O),i.addEventListener("dragleave",q),i.addEventListener("drop",de),t.appendChild(o),t.appendChild(s),n.appendChild(a),n.appendChild(i),r.board.appendChild(t),r.board.appendChild(n),ve(i,3,4),we(i)}function se(e){const t=e.currentTarget;t.classList.add("dragging"),e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move"}function ie(e){e.currentTarget.classList.remove("dragging")}function N(e){e.preventDefault()}function O(e){e.preventDefault(),e.currentTarget.classList.add("drop-hover")}function q(e){e.currentTarget.classList.remove("drop-hover")}function le(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=z(e);t&&R(e.currentTarget,t)}function de(e){e.preventDefault(),e.currentTarget.classList.remove("drop-hover");const t=z(e);t&&S(t)}function R(e,t){var a;const n=t.parentElement,o=e.querySelector(".word-tile");o&&o!==t&&S(o),n&&n.classList.contains("language-panel")&&j(n),(a=e.querySelector(".placeholder"))==null||a.remove(),e.appendChild(t),t.classList.add("is-snapped"),D(t),fe()}function z(e){const t=e.dataTransfer.getData("text/plain");return t?document.getElementById(t):null}function S(e){const t=document.getElementById("wordPool");if(!t)return;const n=e.parentElement;e.classList.remove("is-snapped"),t.appendChild(e),D(e),n&&n.classList.contains("language-panel")&&j(n)}function ce(e){if(e.pointerType==="mouse"||!l.gameActive||l.touchDrag)return;const t=e.currentTarget,n=t.getBoundingClientRect(),o=t.parentElement;let a=null;o&&o.classList.contains("word-pool")&&(a=document.createElement("div"),a.className="tile-placeholder",a.style.width=`${n.width}px`,a.style.height=`${n.height}px`,a.style.gridRowStart=t.style.gridRowStart,a.style.gridColumnStart=t.style.gridColumnStart,o.insertBefore(a,t)),l.touchDrag={tile:t,pointerId:e.pointerId,offsetX:e.clientX-n.left,offsetY:e.clientY-n.top,originParent:o,placeholder:a,hoverTarget:null,originalStyles:{position:t.style.position,left:t.style.left,top:t.style.top,width:t.style.width,height:t.style.height,zIndex:t.style.zIndex,pointerEvents:t.style.pointerEvents,margin:t.style.margin}},t.classList.add("dragging"),t.style.position="fixed",t.style.left=`${n.left}px`,t.style.top=`${n.top}px`,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,t.style.zIndex="1000",t.style.pointerEvents="none",t.style.margin="0";try{t.setPointerCapture(e.pointerId)}catch{}e.preventDefault(),window.addEventListener("pointermove",H),window.addEventListener("pointerup",k),window.addEventListener("pointercancel",U)}function H(e){const t=l.touchDrag;if(!t||t.pointerId!==e.pointerId)return;e.preventDefault();const n=e.clientX-t.offsetX,o=e.clientY-t.offsetY;t.tile.style.left=`${n}px`,t.tile.style.top=`${o}px`,ue(_(e.clientX,e.clientY))}function k(e){X(e,!1)}function U(e){X(e,!0)}function X(e,t){const n=l.touchDrag;if(!n||n.pointerId!==e.pointerId)return;const o=t?null:_(e.clientX,e.clientY);ge(),o&&o.classList.contains("language-panel")?R(o,n.tile):o&&o.id==="wordPool"?S(n.tile):pe(n),me()}function _(e,t){const n=document.elementFromPoint(e,t);if(!n)return null;const o=n.closest(".language-panel");return o||n.closest("#wordPool")}function ue(e){const t=l.touchDrag;!t||t.hoverTarget===e||(t.hoverTarget&&t.hoverTarget.classList.remove("drop-hover"),t.hoverTarget=e,e&&e.classList.add("drop-hover"))}function ge(){const e=l.touchDrag;e&&e.hoverTarget&&(e.hoverTarget.classList.remove("drop-hover"),e.hoverTarget=null)}function pe(e){var t;!e||!e.originParent||(e.originParent.classList.contains("language-panel")?((t=e.originParent.querySelector(".placeholder"))==null||t.remove(),e.originParent.appendChild(e.tile),e.tile.classList.add("is-snapped")):(e.originParent.appendChild(e.tile),e.tile.classList.remove("is-snapped")),D(e.tile))}function me(){const e=l.touchDrag;e&&(e.placeholder&&e.placeholder.remove(),window.removeEventListener("pointermove",H),window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",U),l.touchDrag=null)}function D(e){if(!e)return;e.classList.remove("dragging");const t=l.touchDrag&&l.touchDrag.tile===e?l.touchDrag:null;t&&t.originalStyles?(e.style.position=t.originalStyles.position,e.style.left=t.originalStyles.left,e.style.top=t.originalStyles.top,e.style.width=t.originalStyles.width,e.style.height=t.originalStyles.height,e.style.zIndex=t.originalStyles.zIndex,e.style.pointerEvents=t.originalStyles.pointerEvents,e.style.margin=t.originalStyles.margin):(e.style.position="",e.style.left="",e.style.top="",e.style.zIndex="",e.style.pointerEvents="",e.style.margin="")}function fe(){const e=r.board.querySelectorAll(".language-panel");if(!e.length)return;Array.from(e).every(n=>n.querySelector(".word-tile"))&&he()}function he(e){if(!l.gameActive)return;l.gameActive=!1,r.board.classList.add("is-locked");const t=r.board.querySelectorAll(".language-panel");let n=!0;t.forEach(o=>{const a=o.dataset.expected,s=o.querySelector(".word-tile"),i=s?s.dataset.word:null,u=i&&i===a;o.classList.remove("is-correct","is-wrong"),o.classList.add(u?"is-correct":"is-wrong"),u||(n=!1)}),r.status.textContent="All pairs placed. Reviewing your matches.",n?(I(m.win),Le()):I(m.error),xe()}function ye(){r.board.innerHTML="",r.board.classList.remove("is-locked"),r.progressWrap.hidden=!0,r.startBtn.disabled=!1,r.gameImage.src=T,l.currentItem=null,A("Remembering Van Gogh"),r.status.textContent="Press Start when you are ready.",M()}function j(e){if(e.querySelector(".word-tile")||e.querySelector(".placeholder"))return;const t=document.createElement("span");t.className="placeholder",t.textContent="Drop word here",e.appendChild(t)}function we(e){const t=Array.from(e.querySelectorAll(".word-tile"));if(!t.length)return;const n=()=>{const o=t.reduce((a,s)=>{s.style.width="auto";const i=s.scrollWidth;return Math.max(a,i)},0);o&&t.forEach(a=>{a.style.width=`${Math.ceil(o)}px`})};document.fonts&&document.fonts.ready?document.fonts.ready.then(()=>requestAnimationFrame(n)):requestAnimationFrame(n)}function ve(e,t,n){const o=Array.from(e.querySelectorAll(".word-tile")),a=t*n;if(o.length>a)return;const s=[];for(let i=1;i<=t;i+=1)for(let u=1;u<=n;u+=1)s.push({row:i,col:u});E(s),o.forEach((i,u)=>{const d=s[u];d&&(i.style.gridRowStart=d.row,i.style.gridColumnStart=d.col)})}function Ee(){Y(!l.muted)}function Y(e){l.muted=e;const t=e?"Sound: Off":"Sound: On";r.muteToggle.textContent=t,r.muteToggle.setAttribute("aria-pressed",String(e)),Object.values(m).forEach(n=>{n.muted=e})}function I(e){l.muted||(e.currentTime=0,e.play().catch(()=>{}))}function W(e){e.pause(),e.currentTime=0}function A(e){r.imageCaption.textContent=e}function Le(){if(P)return;const e=10,t=26,n=["#df7a4f","#1f6f5a","#ffe800","#667eea","#f093fb"],o=document.createElement("div");o.className="confetti",o.setAttribute("aria-hidden","true");for(let a=0;a<e;a+=1){const s=15+Math.random()*70,i=8+Math.random()*28;for(let u=0;u<t;u+=1){const d=document.createElement("span"),p=Math.floor(5+Math.random()*6),c=Math.random()*Math.PI*2,g=110+Math.random()*150,f=Math.cos(c)*g,h=Math.sin(c)*g,y=Math.random()*.25,L=2.3+Math.random()*1.2,w=n[(a+u)%n.length],v=Math.random()>.45?"999px":"2px";d.style.width=`${p}px`,d.style.height=`${Math.ceil(p*1.3)}px`,d.style.backgroundColor=w,d.style.setProperty("--origin-x",`${s}vw`),d.style.setProperty("--origin-y",`${i}vh`),d.style.setProperty("--dx",`${f.toFixed(1)}px`),d.style.setProperty("--dy",`${h.toFixed(1)}px`),d.style.setProperty("--rot",`${Math.floor(Math.random()*360)}deg`),d.style.setProperty("--delay",`${y.toFixed(2)}s`),d.style.setProperty("--duration",`${L.toFixed(2)}s`),d.style.setProperty("--round",v),o.appendChild(d)}}document.body.appendChild(o),window.setTimeout(()=>{o.remove()},3500)}function xe(){var e;r.endModal&&(r.endModal.hidden=!1,(e=r.newGameBtn)==null||e.focus())}function M(){r.endModal&&(r.endModal.hidden=!0)}function Ie(){M(),ye(),G()}async function F(e){e.complete&&e.naturalWidth>0||await new Promise((t,n)=>{const o=()=>{s(),t()},a=()=>{s(),n(new Error("Image failed to load"))},s=()=>{e.removeEventListener("load",o),e.removeEventListener("error",a)};e.addEventListener("load",o),e.addEventListener("error",a)})}function Ce(){return P?Promise.resolve():new Promise(e=>{const t=r.gameImage,n=r.pixelCanvas,o=n.getContext("2d"),a=t.naturalWidth||t.clientWidth,s=t.naturalHeight||t.clientHeight;n.width=a,n.height=s,n.style.width=`${t.clientWidth}px`,n.style.height=`${t.clientHeight}px`,n.style.display="block",t.style.opacity="0";const i=24,u=24,d=a/u,p=s/i,c=[];for(let h=0;h<i;h+=1)for(let y=0;y<u;y+=1)c.push({row:h,col:y});const g=performance.now(),f=h=>{const y=h-g;E(c);let L=0;for(let w=0;w<i;w+=1)for(let v=0;v<u;v+=1){const B=c[L++];o.drawImage(t,v*d,w*p,d,p,B.col*d,B.row*p,d,p)}y<J?requestAnimationFrame(f):(n.style.display="none",t.style.opacity="1",e())};requestAnimationFrame(f)})}function E(e){for(let t=e.length-1;t>0;t-=1){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}
